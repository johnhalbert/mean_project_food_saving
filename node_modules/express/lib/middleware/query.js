<<<<<<< HEAD
=======
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */

'use strict';

>>>>>>> b54e1981eb56a6b330fbeb153848a4b67979d08e
/**
 * Module dependencies.
 */

var parseUrl = require('parseurl');
var qs = require('qs');

/**
 * @param {Object} options
 * @return {Function}
 * @api public
 */

module.exports = function query(options) {
<<<<<<< HEAD
=======
  var opts = Object.create(options || null);
>>>>>>> b54e1981eb56a6b330fbeb153848a4b67979d08e
  var queryparse = qs.parse;

  if (typeof options === 'function') {
    queryparse = options;
<<<<<<< HEAD
    options = undefined;
=======
    opts = undefined;
  }

  if (opts !== undefined) {
    if (opts.allowDots === undefined) {
      opts.allowDots = false;
    }

    if (opts.allowPrototypes === undefined) {
      opts.allowPrototypes = true;
    }
>>>>>>> b54e1981eb56a6b330fbeb153848a4b67979d08e
  }

  return function query(req, res, next){
    if (!req.query) {
      var val = parseUrl(req).query;
<<<<<<< HEAD
      req.query = queryparse(val, options);
=======
      req.query = queryparse(val, opts);
>>>>>>> b54e1981eb56a6b330fbeb153848a4b67979d08e
    }

    next();
  };
};
